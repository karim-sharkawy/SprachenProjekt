<!DOCTYPE HTML>
<html>
<head>
    <title>Sprachen Karte</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <style>
        body {
            background-color: white !important;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .map-wrapper {
            background-color: #f0f0f0; 
            padding: 0px;
            border-radius: 0px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%; 
            height: 100%; 
        }

        .map-container {
            border: 5px solid black; /* White border around the map container */
            padding: 0px; /* Adjust padding as needed */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4); /* Optional shadow for depth */
            width: 80%; /* Adjust width as needed */
            height: 70%; /* Adjust height as needed */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: white;
        }
        #chartdiv {
            width: 100%;
            height: 100vh;
            z-index: 10;
        }

        .status-buttons {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-bottom: 20px; /* Adjust spacing as needed */
          padding-top: 20px; /* Add padding above the buttons */
        }

        .status-button {
          margin: 0 10px; /* Adjust spacing between buttons */
          padding: 12px 24px; /* Ensure sufficient padding for a larger clickable area */
          border: none;
          border-radius: 25px; /* Rounded border */
          color: black !important;
          font-size: 16px;
          font-weight: bold; 
          cursor: pointer;
          /* background-image: linear-gradient(to right, #4CAF50, #2ECC71); Gradient background */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); /* Soft shadow */
          transition: all 0.3s ease; /* Smooth transition */
          line-height: 1.5; /* Adjust line height */
          display: flex; /* Use inline-flex for better vertical alignment */
          justify-content: center; /* Center text horizontally */
          align-items: center; /* Center text vertically */
        }

        .status-button:hover {
            transform: translateY(-2px); /* Lift on hover */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2); /* Enhanced shadow */
        }

        .all {
            background-image: linear-gradient(to right, white, lightgray)
        }

        .alive {
            background-image: linear-gradient(to right,#2ECC71, #4CAF50); /* Green gradient */
        }

        .endangered {
            background-image: linear-gradient(to right, #F1C40F, #F39C12); /* Yellow gradient */
        }

        .extinct {
            background-image: linear-gradient(to right, #E74C3C, #C0392B); /* Red gradient */
        }
    </style>
</head>

<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
        <nav id="nav" style="position:initial">
          <ul>
              <li><a href="index.html">Back to Introduction</a></li>
              <li><a href="map.html">View Map</a></li>
          </ul>
        </nav>
    
        <!-- Header, Nav, Main, and Footer for the map page -->
        <!-- Add your map section content here -->
        <!-- Map Container -->
        <section id="cta" class="main special">
            <header class="major">
                <h2>The Map</h2>
                <p>Feel free to contact me for any suggestions!</p>
            </header>
            <!-- Map Container -->

            <div class="status-buttons">
              <button class="status-button all" onclick="filterLanguages('Default')">All</button>
              <button class="status-button alive" onclick="filterLanguages('Stable')">Alive</button>
              <button class="status-button endangered" onclick="filterLanguages('Endangered')">Endangered</button>
              <button class="status-button extinct" onclick="filterLanguages('Extinct')">Extinct</button>
          </div>

          <div id="chartdiv" class="map-container" style="display: flex; justify-content: center; align-items: center; width: 100%; height: 100vh; margin: 0 auto;"></div> <!-- Ensure to set height and width for the map container -->
            
        </section>
                      
        <!-- Resources -->
        <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
        <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
        <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
        <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

        <!-- Chart code -->
        <script>
            am5.ready(function() {
                // Debounce function to limit the rate of function calls
                function debounce(func, wait) {
                    let timeout;
                    return function() {
                        const context = this, args = arguments;
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(context, args), wait);
                    };
                }

                // Create root element
                var root = am5.Root.new("chartdiv");

                // Set themes
                root.setThemes([am5themes_Animated.new(root)]);

                // Create the map chart
                var chart = root.container.children.push(am5map.MapChart.new(root, {
                    panX: "rotateX",
                    panY: "rotateY",
                    projection: am5map.geoOrthographic(),
                    paddingBottom: 20,
                    paddingTop: 20,
                    paddingLeft: 20,
                    paddingRight: 20
                }));

                // Create main polygon series for countries
                var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                    geoJSON: am5geodata_worldLow 
                }));

                polygonSeries.mapPolygons.template.setAll({
                    tooltipText: "{name}",
                    toggleKey: "active",
                    interactive: true
                });

                polygonSeries.mapPolygons.template.states.create("hover", {
                    fill: root.interfaceColors.get("primaryButtonHover")
                });

                polygonSeries.mapPolygons.template.states.create("active", {
                    fill: root.interfaceColors.get("primaryButtonHover")
                });

                // Create series for background fill
                var backgroundSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {}));
                backgroundSeries.mapPolygons.template.setAll({
                    fill: root.interfaceColors.get("alternativeBackground"),
                    fillOpacity: 0.1,
                    strokeOpacity: 0
                });
                backgroundSeries.data.push({
                    geometry: am5map.getGeoRectangle(90, 180, -90, -180)
                });

                var graticuleSeries = chart.series.unshift(
                    am5map.GraticuleSeries.new(root, {
                        step: 10
                    })
                );

                graticuleSeries.mapLines.template.set("strokeOpacity", 0.1);

                var pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {
                    valueField: "value"
                }));

                pointSeries.bullets.push(function() {
                    let circle = am5.Circle.new(root, {
                        radius: 2,  // Reduced point size
                        fill: am5.color(0x000000),
                        tooltipText: "{name}\nFamily: {family}\nPopulation: {population}"
                    });

                    return am5.Bullet.new(root, { sprite: circle });
                });

                // Variable to hold the language data
                let languageData = [];

                // Function to load JSON data lazily
                function loadLanguageData(callback) {
                    fetch('language_info.json') // Replace with your actual JSON file path
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            languageData = data; // Store fetched data in languageData variable
                            console.log('Loaded JSON data:', languageData);

                            if (callback) callback(languageData);
                        })
                        .catch(error => console.error('Error loading JSON:', error));
                }

                // Function to add points to the map
                function addLanguagePoints(data) {
                    data.forEach(language => {
                        pointSeries.data.push({
                            geometry: {
                                type: "Point",
                                coordinates: [language.longitude, language.latitude]
                            },
                            name: language.name,
                            family: language.family,
                            population: language.population
                        });
                    });
                }

                // Initialize the map with a specific status
                function initializeMap(status) {
                    filterLanguages(status);
                }

                // Filter languages by status
                function filterLanguages(status) {
                    pointSeries.data.setAll([]); // Clear current data
                    const filteredData = languageData.filter(language => status === 'Default' || language.status === status);
                    addLanguagePoints(filteredData);
                }

                // Load the data and initialize the map
                loadLanguageData(() => initializeMap("Default"));

                // Set up events
                var previousPolygon;

                polygonSeries.mapPolygons.template.on("active", function(active, target) {
                    if (previousPolygon && previousPolygon != target) {
                        previousPolygon.set("active", false);
                    }
                    if (target.get("active")) {
                        selectCountry(target.dataItem.get("id"));
                    }
                    previousPolygon = target;
                });

                function selectCountry(id) {
                    var dataItem = polygonSeries.getDataItemById(id);
                    var target = dataItem.get("mapPolygon");
                    if (target) {
                        var centroid = target.geoCentroid();
                        if (centroid) {
                            chart.animate({
                                key: "rotationX",
                                to: -centroid.longitude,
                                duration: 1500,
                                easing: am5.ease.inOut(am5.ease.cubic)
                            });
                            chart.animate({
                                key: "rotationY",
                                to: -centroid.latitude,
                                duration: 1500,
                                easing: am5.ease.inOut(am5.ease.cubic)
                            });
                        }
                    }
                }

                // Uncomment this to pre-center the globe on a country when it loads
                //polygonSeries.events.on("datavalidated", function() {
                //  selectCountry("AU");
                //});

                // Make stuff animate on load
                chart.appear(1000, 100);
            }); // end am5.ready()
        </script>
    </div>
</body>
</html>
